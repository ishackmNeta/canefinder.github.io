<html>
<head>
  <title>Neta Map</title>
  
  <script>
    function myFunction() {
      alert("Welcome to Neta Maps. Please wait for a few seconds.");
    }
    
    myFunction()


  </script>

  <link rel="stylesheet" href="leaflet.css" /> 

  <script src="leaflet.js"></script>




  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="L.Control.Locate.min.css" />
  <script src="L.Control.Locate.min.js" charset="utf-8"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css"/>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css"/>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-ajax/2.1.0/leaflet.ajax.min.js"></script>
  <script
  src="https://code.jquery.com/jquery-2.2.4.js"
  integrity="sha256-iT6Q9iMJYuQiMWNd9lDyBUStIq/8PuOW33aOqmvFpqI="
  crossorigin="anonymous"></script>
  <script src="https://unpkg.com/leaflet@1.2.0/dist/leaflet-src.js"></script>

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

<script src="https://cdn.jsdelivr.net/npm/leaflet.locatecontrol/dist/L.Control.Locate.min.js" charset="utf-8"></script>
    
<link rel="stylesheet" href="Control.FullScreen.css" />
<script src="Control.FullScreen.js"></script>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/0.4.2/leaflet.draw.css"/>
<script src="leaflet.draw.js"></script>

<link rel="stylesheet" href="measure/leaflet.measure.css" />
<script src="measure/leaflet.measure.js"></script>

   <link rel="stylesheet" href="leaflet-search.css"/>
   <script src="leaflet-search.js"></script>
    <script src="leaflet.ajax.min.js"></script>

    <link rel="stylesheet" href="leaflet-legend.css"/>
    <script src="leaflet-legend.js"></script>
   


   
  <style>
    #map{ width: 100%; height: 100%; }
  </style>




</head>
<body>

  


  <div id="map"></div>
  <div id='delete'></div>
  <a href='#' id='export' class="btn btn-success">Export Features</a>

</body>


  <script>

  // initialize the map

 

  var map = L.map(
                "map",
                {
                    center: [17.6547651, 77.6343897],
                    crs: L.CRS.EPSG3857,
                    zoom: 12,
                    fullscreenControl: true,
                    preferCanvas: true,
                    drawControl: false,
                    titles: "Punggol",
                }
            );
            
  // load a tile layer
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
    {
      attribution: 'Tiles by <a href="http://mapc.org">MAPC</a>, Data by <a href="http://mass.gov/mgis">MassGIS</a>',
      zoomControl: true,
      drawControl: true,
      preferCanvas: true
    }).addTo(map);

  </script>
  <script>

function sugar(feature) {
    return {
        fillColor: 'green',
        color: 'green'  //Outline color
    };
}


  function kml_name(feature, layer) {
  layer.bindPopup(feature.properties.Name);
 }


  var kml = new L.GeoJSON.AJAX("unit2_polygon.geojson",{
         style:sugar, onEachFeature: kml_name});   

         kml.addTo(map);




         function sugar(feature) {
    return {
        fillColor: 'green',
        color: 'green'  //Outline color
    };
}


var riverm = {
    "color": "orange",
    "weight": 3,
    "opacity": 0.65
};
  function network(feature, layer) {
  layer.bindPopup("2 Hectare Stream Network");
 }


  var group3 = new L.GeoJSON.AJAX("streamnetwork.geojson",{
         style:riverm, onEachFeature: network});   

         group3.addTo(map);







url = '<br><a href="https://www.natems.com/">Know more here</a></br>'

function polystyle(feature) {
    return {
        fillColor: 'white',
        weight: 2,
        opacity: 1,
        color: 'red',  //Outline color
        fillOpacity: 0.1
    };
}





function village(feature, layer) {
  layer.bindPopup(feature.properties.title + '<br>' + 'Village ID:' + feature.properties.vi + '</br>' + url);
 }

var group4 = new L.GeoJSON.AJAX("village.geojson",{
         style:polystyle, onEachFeature: village});   

         group4.addTo(map);



var searchControl = new L.Control.Search({
		layer: kml,
		propertyName: 'Name',
		marker: false,
		moveToLocation: function(latlng, title, map) {
			//map.fitBounds( latlng.layer.getBounds() );
			var zoom = map.getBoundsZoom(latlng.layer.getBounds());
  			map.setView(latlng, zoom); // access the zoom
		}
	});

	searchControl.on('search:locationfound', function(e) {
		
		//console.log('search:locationfound', );

		//map.removeLayer(this._markerSearch)

		e.layer.setStyle({fillColor: '#3f0', color: '#0f0'});
		if(e.layer._popup)
			e.layer.openPopup();

	}).on('search:collapsed', function(e) {

		featuresLayer.eachLayer(function(layer) {	//restore feature color
			featuresLayer.resetStyle(layer);
		});	
	});
	
	map.addControl( searchControl );  //inizialize search control

  L.control.locate().addTo(map);




var river_s = {
    "color": "yellow",
    "weight": 3,
    "opacity": 0.65
};


var rv1 = "Narinjavagu River"


function nari(feature, layer) {
  layer.bindPopup(rv1);
 }




var group2 = new L.GeoJSON.AJAX("nari.geojson",{
         style:river_s, onEachFeature: nari});   

         group2.addTo(map);

var water = 
{"type":"FeatureCollection","features":[{"type":"Feature","properties":{"s_no":1,"activity":"Check dam","village":"Kothoor B","latitude":17.724167,"Longitude":77.587776,"Location":"Point - A","length":90,"width":11.5,"depth":0.9,"volume":932},"geometry":{"type":"Point","coordinates":[77.587776,17.724167]}},{"type":"Feature","properties":{"s_no":6,"activity":"Percolation tank","village":"Kothoor B","latitude":17.724443,"Longitude":77.58722,"Location":"Point - A","length":37,"width":11.5,"depth":1.1,"volume":468},"geometry":{"type":"Point","coordinates":[77.58722,17.724445]}},{"type":"Feature","properties":{"s_no":10,"activity":"Outlet channel to percolation tank","village":"Kothoor B","latitude":17.724443,"Longitude":77.58583,"Location":"Outlet","length":30,"width":2,"depth":0.3,"volume":null},"geometry":{"type":"Point","coordinates":[77.58583,17.724445]}}]}




var myIcon = L.icon({
  iconUrl: 'dam.png',
  iconSize: [32, 37],
  iconAnchor: [16, 37],
  popupAnchor: [0, -28]
});


var village = "Village: Kothoor B"

function onEachFeature(feature, layer) {
  layer.bindPopup(village + '<br>' + 'S_No:' + feature.properties.s_no + '<br>' + 'Activity: ' + feature.properties.activity + '</br>' + 'Volume: ' + feature.properties.volume + '</br>' + 'Length: ' + feature.properties.length + 'm</br>'+ 'Width: ' + feature.properties.width + 'm</br>' + 'Depth: ' + feature.properties.depth + 'm</br>');
}



dam = L.geoJSON(water, {
  pointToLayer: function (feature, latlng) {
            return L.marker(latlng, {icon: myIcon});
    },
  onEachFeature: onEachFeature
}).addTo(map);






var river_t = {
    "color": "purple",
    "weight": 3,
    "opacity": 0.65
};


var rv2 = "Trident Major Stream"


function rv2_f(feature, layer) {
  layer.bindPopup(rv2);
 }


  var group1 = new L.GeoJSON.AJAX("trident.geojson",{
         style:river_t, onEachFeature: rv2_f});   

         group1.addTo(map);



var myIcon = L.icon({
iconUrl: 'dig.png',
shadowUrl: 'dig.png',
iconSize: [40, 60],
shadowSize: [60, 40],
iconAnchor: [20, 60],
shadowAnchor: [20, 40],
popupAnchor: [0, -53]
});

var marker1 = L.marker([17.707778, 77.568056],{icon:
myIcon}).addTo(map).bindPopup("Sunken Pit" + '<br>' + 'SI_No:' + "1" + '<br>'+ 'Length: 22m <br>' + 'Width: 3.5m <br>' + 'Depth: 1m <br>'+ 'Volume: 1155 m3 <br>' );

var marker2 = L.marker([17.708056, 77.568611],{icon:
myIcon}).addTo(map).bindPopup("Sunken Pit" + '<br>' + 'SI_No:' + "2" + '<br>'+ 'Length: 22m <br>' + 'Width: 3.5m <br>' + 'Depth: 1m <br>'+ 'Volume: 1155 m3 <br>' );

var marker3 = L.marker([17.708889,77.57],{icon:
myIcon}).addTo(map).bindPopup("Sunken Pit" + '<br>' + 'SI_No:' + "3" + '<br>'+ 'Length: 22m <br>' + 'Width: 3.5m <br>' + 'Depth: 1m <br>'+ 'Volume: 1155 m3 <br>' );

var marker4 = L.marker([17.710556,77.571111],{icon:
myIcon}).addTo(map).bindPopup("Sunken Pit" + '<br>' + 'SI_No:' + "4" + '<br>'+ 'Length: 22m <br>' + 'Width: 3.5m <br>' + 'Depth: 1m <br>'+ 'Volume: 1155 m3 <br>' );

var marker5 = L.marker([17.711389,77.572222],{icon:
myIcon}).addTo(map).bindPopup("Sunken Pit" + '<br>' + 'SI_No:' + "5" + '<br>'+ 'Length: 22m <br>' + 'Width: 3.5m <br>' + 'Depth: 1m <br>'+ 'Volume: 1155 m3 <br>' );


var marker6 = L.marker([17.706111,77.5725],{icon:
myIcon}).addTo(map).bindPopup("Sunken Pit" + '<br>' + 'SI_No:' + "6" + '<br>'+ 'Length: 22m <br>' + 'Width: 3.5m <br>' + 'Depth: 1m <br>'+ 'Volume: 1155 m3 <br>' );



var marker7 = L.marker([17.7125,77.5725],{icon:
myIcon}).addTo(map).bindPopup("Sunken Pit" + '<br>' + 'SI_No:' + "7" + '<br>'+ 'Length: 22m <br>' + 'Width: 3.5m <br>' + 'Depth: 1m <br>'+ 'Volume: 1155 m3 <br>' );

var marker8 = L.marker([17.713333, 77.573333],{icon:
myIcon}).addTo(map).bindPopup("Sunken Pit" + '<br>' + 'SI_No:' + "8" + '<br>'+ 'Length: 22m <br>' + 'Width: 3.5m <br>' + 'Depth: 1m <br>'+ 'Volume: 1155 m3 <br>' );


var marker9 = L.marker([17.713889,77.573611],{icon:
myIcon}).addTo(map).bindPopup("Sunken Pit" + '<br>' + 'SI_No:' + "9" + '<br>'+ 'Length: 22m <br>' + 'Width: 3.5m <br>' + 'Depth: 1m <br>'+ 'Volume: 1155 m3 <br>' );


var marker10 = L.marker([17.714444, 77.574167],{icon:
myIcon}).addTo(map).bindPopup("Sunken Pit" + '<br>' + 'SI_No:' + "10" + '<br>'+ 'Length: 22m <br>' + 'Width: 3.5m <br>' + 'Depth: 1m <br>'+ 'Volume: 1155 m3 <br>' );


var marker11 = L.marker([17.715, 77.574722],{icon:
myIcon}).addTo(map).bindPopup("Sunken Pit" + '<br>' + 'SI_No:' + "11" + '<br>'+ 'Length: 22m <br>' + 'Width: 3.5m <br>' + 'Depth: 1m <br>'+ 'Volume: 1155 m3 <br>' );

var marker12 = L.marker([17.707778, 77.571389],{icon:
myIcon}).addTo(map).bindPopup("Sunken Pit" + '<br>' + 'SI_No:' + "12" + '<br>'+ 'Length: 22m <br>' + 'Width: 3.5m <br>' + 'Depth: 1m <br>'+ 'Volume: 1155 m3 <br>' );


var marker13 = L.marker([17.716667, 77.576389],{icon:
myIcon}).addTo(map).bindPopup("Sunken Pit" + '<br>' + 'SI_No:' + "13" + '<br>'+ 'Length: 22m <br>' + 'Width: 3.5m <br>' + 'Depth: 1m <br>'+ 'Volume: 1155 m3 <br>' );


var marker14 = L.marker([17.716944, 77.576667],{icon:
myIcon}).addTo(map).bindPopup("Sunken Pit" + '<br>' + 'SI_No:' + "14" + '<br>'+ 'Length: 22m <br>' + 'Width: 3.5m <br>' + 'Depth: 1m <br>'+ 'Volume: 1155 m3 <br>' );

var marker15 = L.marker([17.717222, 77.576667],{icon:
myIcon}).addTo(map).bindPopup("Sunken Pit" + '<br>' + 'SI_No:' + "15" + '<br>'+ 'Length: 22m <br>' + 'Width: 3.5m <br>' + 'Depth: 1m <br>'+ 'Volume: 1155 m3 <br>' );


var cities = L.layerGroup([marker1, marker2, marker3, marker4,marker5,marker6,marker7,marker8,marker9,marker10,marker11,marker12,marker13,marker14,marker15]);



function bore1(feature, layer) {
  layer.bindPopup('Sl_No:'+ feature.properties.Sl_No +'<br> District:' + feature.properties.district + '<br> Source of: '+ feature.properties.Source_of + '<br> Crops_Data: '+ feature.properties.crops_deta );
;
 }




var bi = L.icon({
iconUrl: 'road.png',
shadowUrl: 'road.png',
iconSize: [40, 60],
shadowSize: [60, 40],
iconAnchor: [20, 60],
shadowAnchor: [20, 40],
popupAnchor: [0, -53]
});

  var bore = new L.GeoJSON.AJAX("borewell.geojson",{
         style:bi, onEachFeature: bore1});   

         bore.addTo(map);





function tb(feature) {
    return {
        fillColor: 'white',
        weight: 5,
        opacity: 1,
        color: 'pink',  //Outline color
        fillOpacity: 0.1
    };
}




var tb1 = "Trident Basin"



var river_t = {
    "color": "purple",
    "weight": 3,
    "opacity": 0.65
};


var rv2 = "Trident Major Stream"


function basin(feature, layer) {
  layer.bindPopup(tb1);
 }


  var uganda = new L.GeoJSON.AJAX("basin.geojson",{
         style:tb, onEachFeature: basin});   

         uganda.addTo(map);






var myStyle = {
    "color": "blue",
    "weight": 5,
    "opacity": 0.65
};



function kar(feature, layer) {
  layer.bindPopup(feature.properties.name);
 }
 
  var roads = new L.GeoJSON.AJAX("road.geojson",{
         style:myStyle, onEachFeature: kar});   
  
  
  roads.addTo(map);


  function wb(feature) {
    return {
        fillColor: 'red',
        weight: 2,
        opacity: 1,
        color: 'white',  //Outline color
        fillOpacity: 1
    };
}

  function kar1(feature, layer) {
  layer.bindPopup(feature.properties.name);
 }
  var waterbodies = new L.GeoJSON.AJAX("waterbodies.geojson",{
         style:wb, onEachFeature: kar1});   

  waterbodies.addTo(map);


var overlayMaps = {
    "<img src='purple.png' /> Trident Main River": group1,
    "<img src='yellow.png' /> Narinjavagu River": group2,
    "<img src='orange.png' /> Stream Network 2 Hectare": group3,
    "<img src='red.png' /> Village": group4,
    "<img src='dig.png' /> Sunken Pits": cities,
    "<img src='images/marker-icon.png' /> Borewells": bore,
    "<img src='pink.png' /> Trident Basin": uganda,
    "<img src='road.png' /> Major Road Network": roads,
    "<img src='' /> Waterbodies": waterbodies,
    "<img src='dam.png' /> Check Dams/Percolation Tanks": dam
    
 
};


L.control.layers(null, overlayMaps).addTo(map);




L.control.measure({
  position: 'topleft'
}).addTo(map)

// FeatureGroup is to store editable layers
var drawnItems = L.geoJson().addTo(map);
map.addControl(new L.Control.Draw({
    edit: {
        featureGroup: drawnItems
    }
}));

map.on('draw:created', function (event) {
    var layer = event.layer,
    	feature = layer.feature = layer.feature || {};
    
    feature.type = feature.type || "Feature";
    var props = feature.properties = feature.properties || {};
    //layer.feature = {properties: {}}; // No need to convert to GeoJSON.
    //var props = layer.feature.properties;
    props.desc = null;
    props.image = null;
    drawnItems.addLayer(layer);
    addPopup(layer);
});

function addPopup(layer) {
	var content = document.createElement("textarea");
    content.addEventListener("keyup", function () {
    	layer.feature.properties.desc = content.value;
    });
    layer.on("popupopen", function () {
    	content.value = layer.feature.properties.desc;
      content.focus();
    });
    layer.bindPopup(content).openPopup();
}



        // on click, clear all layers
        document.getElementById('delete').onclick = function(e) {
            featureGroup.clearLayers();
        }

        document.getElementById('export').onclick = function(e) {
            // Extract GeoJson from featureGroup
            var data = drawnItems.toGeoJSON();

            // Stringify the GeoJson
            var convertedData = 'text/json;charset=utf-8,' + encodeURIComponent(JSON.stringify(data));
            console.log(convertedData)

            // Create export
            document.getElementById('export').setAttribute('href', 'data:' + convertedData);
            document.getElementById('export').setAttribute('download','data.geojson');
        }
</script>





</html>





