<html>
<head>
  <title>Neta Geo App</title>
  
  <script>
    function myFunction() {
      alert("Welcome to the Neta Geo App.Please wait for a few seconds.");
    }
    
    myFunction()


  </script>

<link rel="stylesheet" type="text/css" href="leaflet.css">
  <script src="leaflet.js"></script>




  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="L.Control.Locate.min.css" />
  <script src="L.Control.Locate.min.js" charset="utf-8"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css"/>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css"/>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-ajax/2.1.0/leaflet.ajax.min.js"></script>
  <script
  src="https://code.jquery.com/jquery-3.5.1.js"
  integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc="
  crossorigin="anonymous"></script>
  <script src="https://unpkg.com/leaflet@1.2.0/dist/leaflet-src.js"></script>

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

<script src="https://cdn.jsdelivr.net/npm/leaflet.locatecontrol/dist/L.Control.Locate.min.js" charset="utf-8"></script>
    
<link rel="stylesheet" href="Control.FullScreen.css" />
<script src="Control.FullScreen.js"></script>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/0.4.2/leaflet.draw.css"/>
<script src="leaflet.draw.js"></script>

<link rel="stylesheet" href="measure/leaflet.measure.css" />
<script src="measure/leaflet.measure.js"></script>

   <link rel="stylesheet" href="leaflet-search.css"/>
   <script src="leaflet-search.js"></script>
    <script src="leaflet.ajax.min.js"></script>

    <link rel="stylesheet" href="leaflet-legend.css"/>
    <script src="leaflet-legend.js"></script>
   


   
  <style>
    #map{ width: 100%; height: 100%; }

  #export {
  position: absolute;
  top: 550px;
  right: 20px;
  padding: 10px;
  z-index: 400;
}

.leaflet-tooltip.my-labels {
  background-color:wheat;
  border: red;
  box-shadow: none;
  }
  </style>




</head>
<body>

  


  <div id="map"></div>
  <div id='delete'></div>
  <a href='#' id='export' class="btn btn-success">Export Features</a>
     

</body>


  <script>

    //OSM tiles attribution and URL
		var osmLink = '<a href="http://openstreetmap.org">OpenStreetMap</a>';
		var osmURL = 'http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png';
		var osmAttrib = '&copy; ' + osmLink;
		
		//Carto tiles attribution and URL
		var cartoLink = '<a href="http://cartodb.com/attributions">CartoDB</a>';
		var cartoURL = 'https://stamen-tiles-{s}.a.ssl.fastly.net/terrain-background/{z}/{x}/{y}{r}.png';
		var cartoAttrib = '&copy; ' + osmLink + ' &copy; ' + cartoLink;

		//Stamen Toner tiles attribution and URL
		var stamenURL = 'http://stamen-tiles-{s}.a.ssl.fastly.net/toner/{z}/{x}/{y}.{ext}';
		var stamenAttrib = 'Map tiles by <a href="http://stamen.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>';

		//Creation of map tiles
		var osmMap = L.tileLayer(osmURL, {attribution: osmAttrib});
		var cartoMap = L.tileLayer(cartoURL, {attribution: cartoAttrib});

  // initialize the map

 

  var map = L.map(
                "map",
                {
                    center: [17.6547651, 77.6343897],
                    crs: L.CRS.EPSG3857,
                    zoom: 12,
                    fullscreenControl: true,
                    preferCanvas: true,
                    drawControl: false,
                    titles: "Punggol",
                }
            );
            

map.options.closePopupOnClick = false
  // load a tile layer
  var original = L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png',
    {
      attribution: 'Map data: &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, <a href="http://viewfinderpanoramas.org">SRTM</a> | Map style: &copy; <a href="https://opentopomap.org">OpenTopoMap</a> (<a href="https://creativecommons.org/licenses/by-sa/3.0/">CC-BY-SA</a>)',
      zoomControl: true,
      drawControl: true,
      preferCanvas: true
    }).addTo(map);

  </script>
  <script>
var arr = [['Field ID','Ryot Number','Ryot Name','Ryot Village','Plot Village','Date','Time']];
var loc = [['Field ID','Ryot Number']];


function sugar(feature) {
    return {
        fillColor: 'green',
        color: 'green'  //Outline color
    };
}

var highlight = {
		'fillColor': 'yellow',
		'weight': 2,
		'opacity': 1
	};



  function kml_name(feature, layer) {
  layer.bindPopup("Field ID:" + feature.properties.Name + '<br>' + 'Ryot Number:' + feature.properties.ryot + '</br>' + 'Ryot Name:' + feature.properties.ryotname + '</br>'
  + 'Ryot Village:' + feature.properties.ryotvillage + '<br> Plot Village:' + feature.properties.plotvillage,
  {closeButton: true, closePopupOnClick:false,closeOnClick:false,autoClose:false},
  );

  

 // initialize array

var test = layer.on("click", function (e) {
                kml.setStyle(sugar); //resets layer colors
                layer.setStyle(highlight);  //highlights selected.
                var name = feature.properties.Name
                var ryot = feature.properties.ryot
                var ryotname = feature.properties.ryotname
                var ryotvillage = feature.properties.ryotvillage
                var plotvillage = feature.properties.plotvillage
                var time = new Date().toLocaleString();
                var date = new Date().toLocaleDateString();
                arr.push([name,ryot,ryotname,ryotvillage,plotvillage,time]);
                var nkml = arr.length - 1; 
                var person = prompt("Are you done finishing collecting data?" + " Number of plots visited/to visit today:" + nkml);
                if (person == "yes") {
                let csvContent = "data:text/csv;charset=utf-8," 
                + arr.map(e => e.join(",")).join("\n");
                var encodedUri = encodeURI(csvContent);
                var link = document.createElement("a");
                link.setAttribute("href", encodedUri);
                var filename = date + '.csv'
                link.setAttribute("download", filename);
                document.body.appendChild(link); // Required for FF
                link.click();

  }

                



                
            }); 

 }

  var kml = new L.GeoJSON.AJAX("unit2_kml_oct.geojson",{
         style:sugar, onEachFeature: kml_name});   










var riverm = {
    "color": "orange",
    "weight": 3,
    "opacity": 0.65
};
  function network(feature, layer) {
  layer.bindPopup("2 Hectare Stream Network");
 }


  var group3 = new L.GeoJSON.AJAX("streamnetwork.geojson",{
         style:riverm, onEachFeature: network});   

         group3.addTo(map);





url = '<br><a href="https://www.natems.com/">Know more here</a></br>'

function polystyle(feature) {
    return {
        fillColor: 'white',
        weight: 2,
        opacity: 1,
        color: 'red',  //Outline color
        fillOpacity: 0.1
    };
}





function village(feature, layer) {
  layer.bindPopup(feature.properties.title + '<br>' + 'Village ID:' + feature.properties.vi + '</br>' + url);
 }

var group4 = new L.GeoJSON.AJAX("village.geojson",{
         style:polystyle, onEachFeature: village});   

         group4.addTo(map);



var searchControl = new L.Control.Search({
		layer: kml,
		propertyName: 'Name',
		marker: false,
		moveToLocation: function(latlng, title, map) {
			//map.fitBounds( latlng.layer.getBounds() );
			var zoom = map.getBoundsZoom(latlng.layer.getBounds());
  			map.setView(latlng, zoom); // access the zoom
		}
	});

	searchControl.on('search:locationfound', function(e) {
		
		//console.log('search:locationfound', );

		//map.removeLayer(this._markerSearch)

		e.layer.setStyle({fillColor: '#3f0', color: '#0f0'});
		if(e.layer._popup)
			e.layer.openPopup();

	}).on('search:collapsed', function(e) {

		featuresLayer.eachLayer(function(layer) {	//restore feature color
			featuresLayer.resetStyle(layer);
		});	
	});
	
	map.addControl( searchControl );  //inizialize search control

  var myLayer = L.geoJSON().addTo(map);
  var lc = L.control.locate({
    layer: lc,
    strings: {
        title: "Show me where I am, yo!"
    }
}).addTo(map);



  var yellow = new L.Icon({
  iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-yellow.png',
  shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
  iconSize: [25, 41],
  iconAnchor: [12, 41],
  popupAnchor: [1, -34],
  shadowSize: [41, 41]
});

  function onLocationFound(e) {
  var radius = e.accuracy / 2;
  var marker = L.marker(e.latlng,{icon:yellow}).addTo(map).bindPopup("You are within " + radius + " meters from this point <br>"+ e.latlng).openPopup();
  var circ = L.circle(e.latlng, radius).addTo(map);

 
}
map.on('locationfound', onLocationFound);

var river_s = {
    "color": "yellow",
    "weight": 3,
    "opacity": 0.65
};


var rv1 = "Narinjavagu River"


function nari(feature, layer) {
  layer.bindPopup(rv1);
 }




var group2 = new L.GeoJSON.AJAX("nari.geojson",{
         style:river_s, onEachFeature: nari});   

         group2.addTo(map);




var myIcon = L.icon({
  iconUrl: 'dam.png',
  iconSize: [32, 37],
  iconAnchor: [16, 37],
  popupAnchor: [0, -28]
});


var village = "Village: Kothoor B"

function onEachFeature4(feature, layer) {
  layer.bindPopup(village + '<br>' + 'S_No:' + feature.properties.s_no + '<br>' + 'Activity: ' + feature.properties.activity + '</br>' + 'Volume: ' + feature.properties.volume + '</br>' + 'Length: ' + feature.properties.length + 'm</br>'+ 'Width: ' + feature.properties.width + 'm</br>' + 'Depth: ' + feature.properties.depth + 'm</br>');
}


dam = new L.GeoJSON.AJAX("https://srv-file7.gofile.io/downloadStore/srv-store3/Q4yDRG/dam.geojson", {
  pointToLayer: function (feature, latlng) {
            return L.marker(latlng, {icon: myIcon});
    },
  onEachFeature: onEachFeature4
}).addTo(map);








var river_t = {
    "color": "purple",
    "weight": 3,
    "opacity": 0.65
};


var rv2 = "Trident Major Stream"


function rv2_f(feature, layer) {
  layer.bindPopup(rv2);
 }


  var group1 = new L.GeoJSON.AJAX("trident.geojson",{
         style:river_t, onEachFeature: rv2_f});   

         group1.addTo(map);






function tb(feature) {
    return {
        fillColor: 'white',
        weight: 5,
        opacity: 1,
        color: 'pink',  //Outline color
        fillOpacity: 0.1
    };
}




var tb1 = "Trident Basin"



var river_t = {
    "color": "purple",
    "weight": 3,
    "opacity": 0.65
};


var rv2 = "Trident Major Stream"


function basin(feature, layer) {
  layer.bindPopup(tb1);
 }


  var uganda = new L.GeoJSON.AJAX("basin.geojson",{
         style:tb, onEachFeature: basin});   

         uganda.addTo(map);


         function mps(feature, layer) {
           var val = (feature.properties.volume)
           layer.bindPopup(val);
 }



var myStyle = {
    "color": "blue",
    "weight": 5,
    "opacity": 0.65
};



function kar(feature, layer) {
  layer.bindPopup(feature.properties.name);
 }
 
  var roads = new L.GeoJSON.AJAX("road.geojson",{
         style:myStyle, onEachFeature: kar});   
  
  
  roads.addTo(map);


  function wb(feature) {
    return {
        fillColor: '#add8e6',
        weight: 2,
        opacity: 1,
        color: 'white',  //Outline color
        fillOpacity: 1
    };
}

  function kar1(feature, layer) {
  layer.bindPopup(feature.properties.name);
 }
  var waterbodies = new L.GeoJSON.AJAX("waterbodies.geojson",{
         style:wb, onEachFeature: kar1});   

  waterbodies.addTo(map);

//test
 
  function kml_name2(feature, layer) {
  layer.bindPopup("Field ID:" + feature.properties.Name + feature.properties.status + '<br>' + 'Ryot Number:' + feature.properties.ryot + '</br>' + 'Ryot Name:' + feature.properties.ryotname + '</br>'
  + 'Ryot Village:' + feature.properties.ryotvillage + '<br> Plot Village:' + feature.properties.plotvillage,
  {closeButton: true, closePopupOnClick:false,closeOnClick:false,autoClose:false},
  );

  
  

 // initialize array



var test = layer.on("click", function (e) {
                kml.setStyle(sugar); //resets layer colors
                
                



                
            }); 

 }





 function sugar1(feature) {
    return {
        fillColor: feature.properties.status,
        color: feature.properties.status,  
        fillOpacity: 0.4

    };
}


// test2


  var kml2 = new L.GeoJSON.AJAX("unit2_kml_oct_v2.geojson",{
         style:sugar1, onEachFeature: kml_name2});   

         kml2.addTo(map);





//test2
 
function kml_name3(feature, layer) {
  layer.bindPopup("Field ID:" + feature.properties.Name + feature.properties.visits + '<br>' + 'Ryot Number:' + feature.properties.ryot + '</br>' + 'Ryot Name:' + feature.properties.ryotname + '</br>'
  + 'Ryot Village:' + feature.properties.ryotvillage + '<br> Plot Village:' + feature.properties.plotvillage,
  {closeButton: true, closePopupOnClick:false,closeOnClick:false,autoClose:false},
  );

  
  
 // initialize array



var test = layer.on("click", function (e) {
                kml.setStyle(sugar); //resets layer colors
                
                



                
            }); 

 }




 function getColor(d) {
    return d < 5 ? 'red' :
           d < 10  ? '#BD0026' :
           d < 14  ? '#ac4b1c' :
           d < 18  ? '#FC4E2A' :
           d < 20  ? '#FD8D3C' :
           d < 25  ? '#FEB24C' :
           d < 30  ? '#FED976' :
                      '#FFEDA0';
}


function ishack(feature) {
    return {
        fillColor: getColor(feature.properties.visits),
        weight: 2,
        opacity: 1,
        color: 'white',
        dashArray: '3',
        fillOpacity: 0.7
    };
}




// test2



  var kml3 = new L.GeoJSON.AJAX("test2.geojson",{
         style:ishack, onEachFeature: kml_name3});   

         kml3.addTo(map);
         
         
         
        

      var sp_icon = L.icon({
      iconUrl: 'dig.png',
      iconSize: [32, 37],
      iconAnchor: [16, 37],
      popupAnchor: [0, -28]
});





         function onEachFeature1(feature, layer) {
  layer.bindPopup('Sunken Pits <br>' + 'S_No:' + feature.properties.si + '<br>' + 'Volume:' + feature.properties.volume + ' m3</br>'+ 'Date of Construction:' + feature.properties.date );
}

test = new L.GeoJSON.AJAX("sp3.geojson", {
  pointToLayer: function (feature, latlng) {
            return L.marker(latlng, {icon: sp_icon});
    },
  onEachFeature: onEachFeature1
}).addTo(map);

// borewell



function bore1(feature, layer) {
  layer.bindPopup('Sl_No:'+ feature.properties.Sl_No +'<br> District:' + feature.properties.district + '<br> Source of: '+ feature.properties.Source_of + '<br> Crops_Data: '+ feature.properties.crops_deta );
;
 }



 var bi = new L.Icon({
  iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png',
  shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
  iconSize: [25, 41],
  iconAnchor: [12, 41],
  popupAnchor: [1, -34],
  shadowSize: [41, 41]
});

bore = new L.GeoJSON.AJAX("borewell.geojson", {
  pointToLayer: function (feature, latlng) {
            return L.marker(latlng, {icon: bi});
    },
  onEachFeature: bore1
}).addTo(map);


// number of re

var re = new L.GeoJSON.AJAX("re.geojson", {
  pointToLayer: function(feature,latlng){
    label = feature.properties.title + "<br> Number of Rural Entreprenuers:" + String(feature.properties.field)  // Must convert to string, .bindTooltip can't use straight 'feature.properties.attribute'
    id = Number(feature.properties.field) // Must convert to string, .bindTooltip can't use straight 'feature.properties.attribute'
    var geojsonMarkerOptions = {radius:id,fillColor:getColor(id),color: "#000",weight: 1,opacity: 1,fillOpacity: 0.8};
    return new L.CircleMarker(latlng,geojsonMarkerOptions).bindTooltip(label, {permanent: false, 
   direction: "center",
   className: "my-labels"}).openTooltip();
    }
  });
map.addLayer(re);
     
  


var overlayMaps = {
    "<img src='purple.png' /> Trident Main River": group1,
    "<img src='yellow.png' /> Narinjavagu River": group2,
    "<img src='orange.png' /> Stream Network 2 Hectare": group3,
    "<img src='red.png' /> Village": group4,
    "<img src='dig.png' /> Sunken Pits": test,
    "<img src='https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-green.png' /> Borewells": bore,
    "<img src='pink.png' /> Trident Basin": uganda,
    "<img src='road.png' /> Major Road Network": roads,
    "<img src='' /> Waterbodies": waterbodies,
    "<img src='' /> Sugarcane Plot Status": kml2,
    "<img src='' /> Number of Visits": kml3,
    "<img src='follow.png' /> Number of re": re,
    "<img src='dam.png' /> Check Dams/Percolation Tanks": dam
    
 
};

var baseLayers = {
			"OSM Mapnik": osmMap,
			"Stamen Toner": original
		};
	  
		 //Add baseLayers to map as control layers

L.control.layers(baseLayers, overlayMaps).addTo(map);




L.control.measure({
  position: 'topleft'
}).addTo(map)

// FeatureGroup is to store editable layers
var drawnItems = L.geoJson().addTo(map);
map.addControl(new L.Control.Draw({
    edit: {
        featureGroup: drawnItems
    }
}));

map.on('draw:created', function (event) {
    var layer = event.layer,
    	feature = layer.feature = layer.feature || {};
    
    feature.type = feature.type || "Feature";
    var props = feature.properties = feature.properties || {};
    //layer.feature = {properties: {}}; // No need to convert to GeoJSON.
    //var props = layer.feature.properties;
    props.desc = null;
    props.image = null;
    drawnItems.addLayer(layer);
    addPopup(layer);
});

function addPopup(layer) {
	var content = document.createElement("textarea");
    content.addEventListener("keyup", function () {
    	layer.feature.properties.desc = content.value;
    });
    layer.on("popupopen", function () {
    	content.value = layer.feature.properties.desc;
      content.focus();
    });
    layer.bindPopup(content).openPopup();
    var ishack = (layer.getLatLng())
    var lat = ([Object.values(ishack)[0]]); //returns 'someVal'
    var long = ([Object.values(ishack)[1]]); //returns 'someVal'
    var uae1 = lat.toString(2);
    var uae2 = long.toString(2);
    var cord = "Latitude <br> " + uae1 + " <br> Longitude <br> " + uae2
    layer.bindTooltip(cord).openTooltip();



}



        // on click, clear all layers
        document.getElementById('delete').onclick = function(e) {
            featureGroup.clearLayers();
        }

        document.getElementById('export').onclick = function(e) {
            // Extract GeoJson from featureGroup
            var data = drawnItems.toGeoJSON();

            // Stringify the GeoJson
            var convertedData = 'text/json;charset=utf-8,' + encodeURIComponent(JSON.stringify(data));

            // Create export
            document.getElementById('export').setAttribute('href', 'data:' + convertedData);
            document.getElementById('export').setAttribute('download','data.geojson');
        }

	  

	  
	  var red = new L.Icon({
  iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png',
  shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
  iconSize: [25, 41],
  iconAnchor: [12, 41],
  popupAnchor: [1, -34],
  shadowSize: [41, 41]
});

        map.on("contextmenu", function (event) {
  ("Coordinates: " + event.latlng.toString());
  L.marker(event.latlng,{icon:red}).bindPopup(event.latlng.toString()).addTo(map);});
	  // done
	  
	  
	  




</script>





</html>





